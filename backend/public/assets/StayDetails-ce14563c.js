<<<<<<<< HEAD:backend/public/assets/StayDetails-ce14563c.js
import{j as e,r as a,c as B,s as te,u as b,a as R,h as L,b as J,d as se,g as F,e as O,f as G,L as ne,i as H,k as le,l as ie,m as oe,n as ae,o as ce,S as A,A as re,p as de,q as W}from"./index-a64648f6.js";import{o as ue}from"./order.service-39e9e4a5.js";import{G as xe,D as fe}from"./DatesModal-69a86c88.js";function he({svgString:t}){return e.jsx("div",{dangerouslySetInnerHTML:{__html:t}})}function ge(){function t(s,n){s.preventDefault();const r=document.getElementById(n);if(r){const o=r.getBoundingClientRect().top+window.scrollY;var d=o-10;n!=="gallery"&&(d=o-70),window.scrollTo({top:d,behavior:"smooth"})}else console.log("Section not found:",n)}return e.jsxs("div",{className:"dynamic-header-nav flex align-center",children:[e.jsx("a",{href:"#gallery",onClick:s=>t(s,"gallery"),children:"Photos"}),e.jsx("a",{href:"#amenities",onClick:s=>t(s,"amenities"),children:"Amenities"}),e.jsx("a",{href:"#reviews",onClick:s=>t(s,"reviews"),children:"Reviews"}),e.jsx("a",{href:"#location",onClick:s=>{s.preventDefault()},children:"Location"})]})}function me({stay:t,setGalleryModal:s}){const n=a.useRef(),[r,d]=a.useState([]),[o,c]=a.useState(null),[u,w]=a.useState(!0);a.useEffect(()=>(t.imgUrls.length>=5&&(d(t.imgUrls.slice(0,5)),N()),()=>{o==null||o.disconnect()}),[]),a.useEffect(()=>{o&&o.observe(n.current)},[o]);function N(){const x=new IntersectionObserver(g=>{g[g.length-1].isIntersecting?(B(!0),w(!0)):(B(!1),w(!1))});c(x)}function y(){s(!0)}return e.jsxs(e.Fragment,{children:[!u&&e.jsx(ge,{}),e.jsxs("section",{className:"gallery-stay-details",id:"gallery",ref:n,children:[r&&r.map((x,g)=>e.jsx("img",{src:x,className:`img${g}`},g)),e.jsxs("button",{className:"show-all-btn flex align-center",onClick:y,children:[e.jsx(he,{svgString:te.showallphotos})," Show all photos"]})]})]})}function pe({beds:t}){const[s,n]=a.useState({});a.useEffect(()=>{r()},[]);function r(){const o=t.reduce((c,u)=>(c[u]?c[u]++:c[u]=1,c),{});n(o)}function d(){let o="";return t.forEach((c,u)=>{s[c]>1?o+=`${s[c]} ${c}s`:o+=`${s[c]} ${c}`,o+=u<t.length-1?", ":""}),o}return s&&e.jsx("p",{className:"bedroom-details",children:d()})}function be({stay:t,userReview:s,onAddReviewModal:n,onReviewsModal:r,isReviewable:d,removeStayReview:o}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overlay",onClick:r}),e.jsxs("div",{className:"reviews-modal",children:[e.jsx("div",{className:"action-div",children:e.jsx("button",{className:"exit-btn",onClick:r})}),e.jsx("div",{className:"modal-content",children:e.jsxs("section",{className:"stay-reviews grid",children:[t.reviews.sort((c,u)=>u.rate-c.rate).map((c,u)=>e.jsxs("article",{className:"review flex column",children:[e.jsxs("div",{className:"user flex align-center",children:[e.jsx("img",{src:c.by.imgUrl}),e.jsxs("div",{className:"user-details-txt flex column",children:[e.jsx("h3",{children:c.by.fullname}),e.jsx("p",{children:c.by.id})," "]})]}),e.jsxs("div",{className:"not-flip-div flex column",children:[e.jsxs("div",{className:"review-score flex align-center",children:[e.jsxs("p",{children:["★".repeat(Math.floor(c.rate)),e.jsx("span",{children:"★".repeat(5-Math.floor(c.rate))})]}),"•",e.jsx("h4",{children:b.timestampToMonthYear(c.at)})]}),e.jsx("div",{className:"review-content",children:e.jsx("p",{children:c.txt})})]}),s&&s.by._id===c.by._id&&e.jsx("button",{className:"delete-btn",onClick:()=>o(c.by._id)})]},`${c.by.id}${u}`)),e.jsx("div",{className:"actions-btns",children:d&&e.jsx("button",{onClick:n,className:"leave-review-btn",children:"Leave Review"})})]})})]})]})}function ve({stay:t,userId:s,onAddReviewModal:n,addStayReview:r}){const[d,o]=a.useState({rate:0,txt:""});a.useEffect(()=>{R.getUserReview(t,s)&&o(R.getUserReview(t,s))},[]);function c(x){o({...d,rate:x})}function u(x){return x<=d.rate?"yellow-star":"gray-star"}function w(x){const g=x.target.value;o(i=>({...i,txt:g}))}const N=a.useCallback(b.debounce(w,300),[]);function y(){setTimeout(()=>{r(d)},300)}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overlay",onClick:n}),e.jsxs("div",{className:"add-review-modal",children:[e.jsxs("header",{className:"flex center",children:[e.jsx("h1",{children:"Add review"}),e.jsx("button",{className:"exit-btn",onClick:n})]}),e.jsxs("div",{className:"modal-content flex column center",children:[e.jsxs("div",{className:"review-rate flex center",children:[e.jsx("h2",{children:"Rating:"}),e.jsx("button",{onClick:()=>c(1),className:`rate-1 ${u(1)}`,children:"★"}),e.jsx("button",{onClick:()=>c(2),className:`rate-2 ${u(2)}`,children:"★"}),e.jsx("button",{onClick:()=>c(3),className:`rate-3 ${u(3)}`,children:"★"}),e.jsx("button",{onClick:()=>c(4),className:`rate-4 ${u(4)}`,children:"★"}),e.jsx("button",{onClick:()=>c(5),className:`rate-5 ${u(5)}`,children:"★"})]}),e.jsxs("div",{className:"review-content flex column center",children:[e.jsx("h2",{children:"Write a review"}),e.jsx("textarea",{rows:"10",cols:"55",onChange:N})]})]}),e.jsx("footer",{className:"flex center",children:e.jsx("button",{onClick:y,children:"Save"})})]})]})}function je({stay:t,userId:s,isReviewable:n,addStayReview:r,removeStayReview:d,addReviewModal:o,setAddReviewModal:c}){const[u,w]=a.useState([]),[N,y]=a.useState(!1),[x,g]=a.useState(null);function i(f){let m="";for(let C=0;C<130;C++)m+=f[C];return m+="...",m}a.useEffect(()=>{if(s){const f=R.getUserReview(t,s);g(f)}},[t]),a.useEffect(()=>{w(t.reviews.sort((f,m)=>m.rate-f.rate).slice(0,6))},[t.reviews]);function S(){y(!N)}function v(){c(!o)}return e.jsxs(e.Fragment,{children:[u.length>0&&e.jsxs("section",{className:"stay-reviews-section grid",children:[u.map((f,m)=>e.jsxs("article",{className:"review flex column",children:[e.jsxs("div",{className:"user flex align-center",children:[e.jsx("img",{src:f.by.imgUrl}),e.jsxs("div",{className:"user-details-txt flex column",children:[e.jsx("h3",{children:f.by.fullname}),e.jsx("p",{children:f.by._id})," "]})]}),e.jsxs("div",{className:"not-flip-div flex column",children:[e.jsxs("div",{className:"review-score flex align-center",children:[e.jsxs("p",{children:["★".repeat(Math.floor(f.rate)),e.jsx("span",{children:"★".repeat(5-Math.floor(f.rate))})]}),"·",e.jsx("h4",{children:b.timestampToMonthYear(f.at)})]}),e.jsxs("div",{className:"review-content",children:[e.jsx("p",{children:f.txt.length>130?i(f.txt):f.txt}),f.txt.length>130&&e.jsx("button",{onClick:S,children:"Read more"})]})]}),x&&x.by._id===f.by._id&&e.jsx("button",{className:"delete-btn",onClick:()=>d(f.by._id)})]},`${f.by._id}${m}`)),e.jsxs("div",{className:"actions-btns flex space-between",children:[e.jsx("button",{className:"show-all-btn",onClick:S,children:"Show all reviews"}),n&&e.jsx("button",{onClick:v,className:"leave-review-btn",children:"Leave Review"})]})]}),N&&e.jsx(be,{stay:t,userReview:x,onReviewsModal:S,onAddReviewModal:v,addStayReview:r,isReviewable:n,removeStayReview:d}),o&&s&&e.jsx(ve,{stay:t,userId:s,onAddReviewModal:v,addStayReview:r})]})}const $="stay/",we={query:Ne,getById:ye,save:ke,remove:Ce,getLabels:Se,getNumberOfNights:De,getFilterFromParams:Re,getEmptyOrder:$e,getEmptyStay:Me,getDefaultFilter:Y,getEmptyModalFilter:Le,getUserReview:Te,guestCountString:Ae,createDemoData:Ee,guestCountStringForReservation:Ue,generateRandomDate:_e,generateRandomDistance:Ie};function Ne(){return L.get($)}function ye(t){return L.get($+t)}function Se(t){return t.labels}function Ce(t){return L.delete($+t)}function ke(t){return t._id?L.put($,t):L.post($,t)}function De({entryDate:t,exitDate:s}){const n=s-t;return Math.ceil(n/(1e3*60*60*24))}function Re(t){const s=Y();return{txt:t.get("txt")||s.txt,entryDate:t.get("entryDate")||s.entryDate,exitDate:t.get("exitDate")||s.exitDate,guestCount:t.get("guestCount")||s.guestCount,label:t.get("label")||s.label,placeType:t.get("placeType")||s.placeType,priceRange:{min:t.get("priceRangeMin")||s.priceRange.min,max:t.get("priceRangeMax")||s.priceRange.max},bbb:{bedrooms:t.get("bedrooms")||s.bbb.bedrooms,beds:t.get("beds")||s.bbb.beds,bathrooms:t.get("bathrooms")||s.bbb.bathrooms},propType:t.get("propType")||s.propType,amenities:t.getAll("amenities")||s.amenities,bookingOpts:{instant:t.get("instant")==="true"||s.bookingOpts.instant,selfCheckIn:t.get("selfCheckIn")==="true"||s.bookingOpts.selfCheckIn,allowsPets:t.get("allowsPets")==="true"||s.bookingOpts.allowsPets},accessibility:t.getAll("accessibility")||s.accessibility,hostLngs:t.getAll("hostLngs")||s.hostLngs}}function Me(){return{placeType:"",propertyType:"",name:"",summary:"",price:0,capacity:0,amenities:[],labels:[],reviews:[],imgUrls:[],bookingOpts:{instant:!1,selfCheckIn:!1,allowsPets:!1},bbb:{bathrooms:0,baths:0,bedrooms:[],beds:0},loc:{country:"",countryCode:"",city:"",address:"",lng:0,lat:0},host:{_id:"",fullname:"",location:"",about:"",responseTime:"",experience:{isSuperhost:!1}},bookedDates:[],likedByUsers:[]}}function Y(){return{txt:"",entryDate:"",exitDate:"",guestCount:{adults:0,children:0,infants:0,pets:0},label:"",placeType:"any",priceRange:{min:0,max:2e3},bbb:{bedrooms:"any",beds:"any",bathrooms:"any"},propType:[],amenities:[],bookingOpts:{instant:!1,selfCheckIn:!1,allowsPets:!1},accessibility:[],hostLngs:[],pagination:30}}function Le(){return{placeType:"any",priceRange:{min:0,max:2e3},bbb:{bedrooms:"any",beds:"any",bathrooms:"any"},propType:[],amenities:[],bookingOpts:{instant:!1,selfCheckIn:!1,allowsPets:!1},accessibility:[],hostLngs:[]}}function $e(){return{hostId:"",buyer:{_id:"",fullName:""},totalPrice:0,entryDate:"",exitDate:"",guests:{adults:0,children:0,infants:0,pets:0},stay:{_id:"",name:"",price:0},msgs:[],status:"pending"}}function Te(t,s){return t.reviews.find(n=>n.by._id===s)}function Ee(t,s){return b.loadFromStorage(t)?b.loadFromStorage(t):b.saveToStorage(t,s)}function Ae(t){const s=t.guestCount.adults+t.guestCount.children;let n="";s>0&&(n=s===1?"1 guest":`${s} guests`);const r=t.guestCount.infants>0?`${t.guestCount.infants} infants`:"",d=t.guestCount.pets>0?`${t.guestCount.pets} pets`:"",o=[n,r,d].filter(Boolean);return o.length===0?"Add guests":o.join(", ")}function Ue(t){const s=+t.adults+ +t.children;let n="";s>0&&(n=s===1?"1 guest":`${s} guests`);const r=t.infants>0?`${t.infants} infants`:"",d=t.pets>0?`${t.pets} pets`:"",o=[n,r,d].filter(Boolean);return o.length===0?"Add guests":o.join(", ")}function _e(t){const s=["Apr 25-26","Apr 27-29","Apr 30-31","May 1-3","May 6-9","Apr 23-25","May 22-24","May 26-29","June 3-5","June 10-13","June 17-19","June 23-26","June 2-5","June 9-11","June 15-18","June 22-24","June 28-30"];let n;return t>=0&&t<=60?n=s[0]:t>60&&t<=120?n=s[1]:t>120&&t<=180?n=s[2]:t>180&&t<=240?n=s[3]:t>240&&t<=300?n=s[4]:t>300&&t<=360?n=s[5]:t>360&&t<=420?n=s[6]:t>462&&t<=480?n="Apr 23-25":t>480&&t<=540?n=s[8]:t>540&&t<=600?n=s[9]:t>600&&t<=660?n=s[10]:t>660&&t<=720?n=s[11]:t>720&&t<=780?n=s[12]:t>780&&t<=840?n=s[13]:t>840&&t<=900?n=s[14]:t>900&&t<=960?n=s[15]:t>960&&t<=1020?n=s[16]:t>1020&&t<=1080?n=s[17]:t>1080&&t<=1140?n=s[18]:n=s[19],n}function Ie(t){const s=t.loc.country.toLowerCase(),n={turkey:Math.floor(2050+t.loc.lng),"united states":Math.floor(9500+t.loc.lng),france:Math.floor(2900+t.loc.lng),portugal:Math.floor(3600+t.loc.lng),spain:Math.floor(2800+t.loc.lng),brazil:Math.floor(9400+t.loc.lng),canada:Math.floor(7800+t.loc.lng),"hong kong":Math.floor(5600+t.loc.lng),italy:Math.floor(2100+t.loc.lng)};return s in n?n[s].toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):(Math.floor(Math.random()*2001)+1e3).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function Be({stay:t,searchParams:s}){const n=J();function r(){if(s.entryDate&&s.exitDate&&(s.adults||s.children||s.infants)){const d=new URLSearchParams({entryDate:s.entryDate,exitDate:s.exitDate,adults:s.adults||"",children:s.children||"",infants:s.infants||""}).toString();n(`/${t._id}/payment?${d}`)}}return e.jsxs("div",{className:"dynamic-modal-header flex align-center",children:[e.jsxs("div",{className:"txt-container flex column",children:[e.jsxs("h3",{children:["$",t.price," ",e.jsx("span",{children:"night"})]}),e.jsxs("p",{className:"txt-reviews",children:["★ ",b.calcRate(t).toFixed(2)," ・ ",t.reviews.length," reviews "]})]}),e.jsx("button",{className:"flex center",onClick:()=>r(),children:"Reserve"})]})}function Fe({stay:t,searchParams:s,setSearchParams:n,bottomClass:r}){const d=J(),[o,c]=a.useState(0),[u,w]=a.useState(0),[N,y]=a.useState(!1),[x,g]=a.useState(null),[i,S]=a.useState(!1),[v,f]=a.useState(null),m=a.useRef(null),C=a.useRef();a.useEffect(()=>{c(b.calcSumOfDays(s)),j(),o&&w(parseInt(o*t.price*.14125))},[s,o]),a.useEffect(()=>{const p=k=>{m.current&&!m.current.contains(k.target)&&g("")};return document.addEventListener("click",p),()=>document.removeEventListener("click",p)},[m]),a.useEffect(()=>(v&&v.observe(C.current),()=>v==null?void 0:v.disconnect()),[v]);function j(){let p=0;const k=new IntersectionObserver(U=>{if(p++,p>2){const T=se.getState().stayModule.isGalleryVisible;!U[0].isIntersecting&&!T?S(!0):S(!1)}});f(k)}function M(p){if(p.stopPropagation(),s.entryDate&&s.exitDate&&s.adults){const k=b.getFormattedParams(s);H.getLoggedInUser()?d(`/${t._id}/payment?${k}`):y(!0)}}return e.jsxs(e.Fragment,{children:[i&&e.jsx(Be,{stay:t,searchParams:s}),e.jsxs("div",{className:"reserve-modal",ref:m,children:[e.jsxs("div",{className:"container-price-selectors",children:[e.jsxs("div",{className:"price-logo flex align-center",children:[e.jsxs("h2",{children:["$",Math.ceil(t.price),"  "]}),e.jsx("span",{children:"night"})]}),e.jsxs("div",{className:"selectors-container flex column",children:[e.jsxs("div",{className:"date-selectors flex",children:[e.jsx("div",{className:"check-in flex",onClick:()=>g(x==="date"?null:"date"),children:e.jsxs("div",{className:"txt flex column",children:[e.jsx("label",{children:"Check-in"}),e.jsxs("div",{className:"txt-date",children:[F(+s.entryDate),"/",O(+s.entryDate)+1,"/",G(+s.entryDate)]})]})}),e.jsx("div",{className:"checkout flex",onClick:()=>g(x==="date"?null:"date"),children:e.jsxs("div",{className:"txt flex column",children:[e.jsx("label",{children:"Checkout"}),e.jsx("div",{className:"txt-date",children:s.exitDate&&!isNaN(+s.exitDate)?`${F(+s.exitDate)}/${O(+s.exitDate)+1}/${G(+s.exitDate)}`:"Add date"})]})})]}),e.jsxs("div",{ref:m,className:"guest-selector flex column",children:[e.jsx("label",{onClick:()=>g(x==="guest"?null:"guest"),className:"guests",children:"Guests"}),e.jsxs("div",{className:"guest-container flex space-between",onClick:()=>g(x==="guest"?null:"guest"),children:[we.guestCountStringForReservation(s),e.jsx("span",{className:`arrow-${x==="guest"?"up":"down"}`})]}),x==="guest"&&e.jsx(xe,{stay:t,searchParams:s,setSearchParams:n,setModal:g}),x==="date"&&e.jsx(fe,{stay:t,searchParams:s,setSearchParams:n})]})]}),e.jsx("button",{className:"reserve-btn flex center",ref:C,onClick:p=>M(p),children:"Reserve"}),+s.entryDate&&+s.exitDate&&e.jsx("p",{className:"charged-p",children:"You won't be charged yet."})]}),e.jsxs("div",{className:"price-calc flex space-between",children:[e.jsxs("span",{children:["$",t.price," X ",o===1?`${o} night`:`${o} nights`]}),e.jsxs("span",{className:"sum",children:["$",Math.ceil(t.price*o*(+s.adults+ +s.children))]})]}),u&&e.jsxs("div",{className:"fee-calc flex space-between",children:[e.jsx("span",{children:"Staybnb service fee"}),e.jsxs("span",{children:["$",u]})]}),u>0&&e.jsxs("div",{className:"sum-total flex space-between",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",Math.ceil(t.price*o*(+s.adults+ +s.children)+u)]})]})]}),e.jsxs("div",{className:`reserve-footer flex align-center space-between ${r}`,children:[e.jsxs("div",{className:"flex column",children:[e.jsxs("p",{children:[e.jsxs("span",{children:["$",t.price]}),"  night"]}),e.jsx("p",{children:b.timestampsToShortDates(+s.entryDate,+s.exitDate)})]}),e.jsx("button",{className:"flex center",onClick:p=>M(p),children:e.jsx("span",{children:"Reserve"})})]}),N&&e.jsx(ne,{setIsLoginModal:y})]})}function Oe({stay:t,setGalleryModal:s}){function n(){s(!1)}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overlay",onClick:n}),e.jsxs("section",{className:"gallery-modal",children:[e.jsxs("header",{className:"flex center",children:[e.jsx("button",{className:"back-btn",onClick:n}),e.jsxs("h1",{children:[t.name," Galley"]})]}),e.jsx("main",{className:"grid",children:t.imgUrls.map((r,d)=>e.jsx("img",{src:r,className:`img-${d}`},d))})]})]})}const He=()=>{const{stayId:t}=le(),{isLoading:s}=ie(l=>l.stayModule),n=["Carbon monoxide alarm","Smoke alarm"],[r,d]=oe(),{adults:o,children:c,infants:u,pets:w,entryDate:N,exitDate:y}=Object.fromEntries(r.entries()),[x,g]=a.useState({adults:o,children:c,infants:u,pets:w,entryDate:N,exitDate:y}),[i,S]=a.useState(""),[v,f]=a.useState(1),[m,C]=a.useState(!1),[j,M]=a.useState(null),[p,k]=a.useState(!1),[U,T]=a.useState(null),[q,I]=a.useState(!1),[z,_]=a.useState("");a.useEffect(()=>{const l=H.getLoggedInUser();l&&M(l),t&&V(t)},[]),a.useEffect(()=>{const l=()=>{_(""),Math.ceil(window.scrollY+window.innerHeight)>=document.body.scrollHeight&&(window.innerWidth<=742&&_("bottom-mobile"),window.innerWidth>742&&_("bottom-tablet"))};return window.addEventListener("scroll",l),()=>window.removeEventListener("scroll",l)},[]),a.useEffect(()=>{i&&f(b.calcLongestBedCount(i)),d(x)},[i,x]),a.useEffect(()=>{i&&j&&(X(),k(!!j.wishlist.find(l=>l._id===i._id)))},[i,j]);async function V(l){try{const h=await ae(l);S(h)}catch(h){throw Error("err",h)}}async function X(){try{const l=await ue.getUserOrdersById(j._id),h=R.getUserReview(i,j._id);T(l.some(D=>D.stay._id===t)&&!h)}catch(l){console.error("err",l),T(!1)}}function K(){const l=i.host,h=l.fullname.indexOf(" ");return l.fullname.slice(0,h)}async function Q(){try{const l=await de(t);M(l),k(!p)}catch(l){throw l}}async function Z(){try{const l=window.location.href;await navigator.clipboard.writeText(l),alert("URL copied to clipboard!")}catch(l){console.error("Failed to copy: ",l)}}async function P(l){l.at=new Date().getTime(),l.by={_id:j._id,fullname:j.fullname,imgUrl:j.imgUrl};try{const h=await R.save({...i,reviews:[...i.reviews,l]});W(h),S(h),I(!1)}catch(h){throw Error("err",h)}}async function ee(){try{const l=i.reviews.findIndex(h=>h.by._id===j._id);if(l!==-1){const h=[...i.reviews];h.splice(l,1);const D={...i,reviews:h},E=await R.save(D);W(E),S(E)}else throw Error("Review not found")}catch(l){throw Error(l)}}return e.jsxs(e.Fragment,{children:[s&&e.jsx(ce,{currentPage:"details"}),i&&e.jsxs("section",{className:"stay-details",children:[e.jsxs("header",{className:"flex space-between",children:[e.jsx("h1",{children:i.summary}),e.jsxs("div",{className:"header-btns flex",children:[e.jsxs("button",{className:"share-btn flex align-center",onClick:Z,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",role:"presentation",focusable:"false",style:{display:"block",fill:"none",height:"16px",width:"16px",stroke:"currentcolor",strokeWidth:"2",overflow:"visible"},children:e.jsx("g",{fill:"none",children:e.jsx("path",{d:"M27 18v9a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-9M16 3v23V3zM6 13l9.3-9.3a1 1 0 0 1 1.4 0L26 13"})})}),e.jsx("span",{children:"Share"})]}),e.jsxs("button",{className:"save-btn flex align-center",onClick:Q,children:[!p&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",role:"presentation",focusable:"false",style:{display:"block",fill:"none",height:"16px",width:"16px",stroke:"currentcolor",strokeWidth:2,overflow:"visible"},children:e.jsx("path",{d:"M16 28c7-4.73 14-10 14-17a6.98 6.98 0 0 0-7-7c-1.8 0-3.58.68-4.95 2.05L16 8.1l-2.05-2.05a6.98 6.98 0 0 0-9.9 0A6.98 6.98 0 0 0 2 11c0 7 7 12.27 14 17z"})}),p&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",role:"presentation",focusable:"false",style:{display:"block",fill:"rgb(255, 56, 92)",height:"16px",width:"16px",stroke:"rgb(255, 56, 92)",strokeWidth:"2",overflow:"visible"},children:e.jsx("path",{d:"M16 28c7-4.73 14-10 14-17a6.98 6.98 0 0 0-7-7c-1.8 0-3.58.68-4.95 2.05L16 8.1l-2.05-2.05a6.98 6.98 0 0 0-9.9 0A6.98 6.98 0 0 0 2 11c0 7 7 12.27 14 17z"})}),e.jsx("span",{children:"Save"})]})]})]}),e.jsx(me,{stay:i,setGalleryModal:C}),e.jsxs("main",{className:"content-and-modal-container grid",children:[e.jsxs("section",{className:"content",children:[e.jsxs("article",{className:"place-info flex column",children:[e.jsxs("h1",{children:["Entire ",i.propertyType," in ",i.loc.city,", ",i.loc.country]}),e.jsxs("p",{children:[i.capacity>1?i.capacity+" guests":"1 guest","・ ",i.bbb.bedrooms.length>1?i.bbb.bedrooms.length+" bedrooms":"1 bedroom","  ・",b.countBedsInBedrooms(i)>1?b.countBedsInBedrooms(i)+" beds":"1 bed"," ・",i.bbb.baths>1?i.bbb.baths+" baths":"1 bath"]}),e.jsxs("p",{className:"reviews-preview",children:["★".repeat(Math.ceil(b.calcRate(i)))," ",b.calcRate(i).toFixed(2)," ・ ",i.reviews.length," reviews"]})]}),e.jsxs("article",{className:"host-info flex",children:[e.jsx("img",{src:i.host.imgUrl,className:"host-img"}),e.jsxs("div",{className:"flex column",children:[e.jsxs("h3",{children:["Hosted by ",K()]}),e.jsx("p",{children:i.host.about})]})]}),e.jsxs("article",{className:"room-info",children:[e.jsx("h1",{children:"Where you'll sleep"}),e.jsx("div",{className:"rooms-container grid",children:i.bbb.bedrooms.map(l=>{const h=l.beds.length;return e.jsxs("div",{className:"bedroom",style:{paddingBlockEnd:h<v?(v-h)*.875+1.5+"rem":"1.5rem"},children:[e.jsx("div",{className:"icons flex align-center",children:l.beds.map((D,E)=>e.jsx(A,{name:D.replaceAll(" ","").toLowerCase()},l+E))}),e.jsx("h4",{children:l.name}),e.jsx(pe,{beds:l.beds})]},l.name)})})]}),e.jsxs("article",{className:"amenity-info",id:"amenities",children:[e.jsx("h1",{children:"What this place offers "}),e.jsxs("ul",{className:"amenities-ul grid",children:[i.amenities.slice(0,9).map(l=>e.jsxs("li",{className:"flex align-center",children:[e.jsx(A,{name:l.replaceAll(" ","").toLowerCase()}),e.jsx("p",{children:l[0].toUpperCase()+l.slice(1)})]},l)),e.jsxs("li",{className:`${i.amenities.includes(n[0])?"":"no-safety-amenity"} flex align-center`,children:[e.jsx(A,{name:n[0].replaceAll(" ","").toLowerCase()}),e.jsx("p",{children:n[0]})]}),e.jsx(re,{children:i.amenities.slice(9).map(l=>e.jsxs("li",{className:"flex align-center",children:[e.jsx(A,{name:l.replaceAll(" ","").replaceAll("'","").toLowerCase()}),e.jsx("p",{children:l[0].toUpperCase()+l.slice(1)})]},l))})]})]})]}),e.jsx(Fe,{stay:i,searchParams:x,setSearchParams:g,bottomClass:z})]}),e.jsx("div",{id:"reviews",children:e.jsx(je,{stay:i,userId:j?j._id:null,isReviewable:U,addStayReview:P,removeStayReview:ee,setAddReviewModal:I,addReviewModal:q})})]}),m&&e.jsx(Oe,{stay:i,setGalleryModal:C})]})};export{He as default};
========
import{j as e,r as a,c as B,s as te,u as b,a as R,h as L,b as J,d as se,g as F,e as O,f as G,L as ne,i as H,k as le,l as ie,m as oe,n as ae,o as ce,S as A,A as re,p as de,q as W}from"./index-5b4f1840.js";import{o as ue}from"./order.service-34aca959.js";import{G as xe,D as fe}from"./DatesModal-86a1a9b5.js";function he({svgString:t}){return e.jsx("div",{dangerouslySetInnerHTML:{__html:t}})}function ge(){function t(s,n){s.preventDefault();const r=document.getElementById(n);if(r){const o=r.getBoundingClientRect().top+window.scrollY;var d=o-10;n!=="gallery"&&(d=o-70),window.scrollTo({top:d,behavior:"smooth"})}else console.log("Section not found:",n)}return e.jsxs("div",{className:"dynamic-header-nav flex align-center",children:[e.jsx("a",{href:"#gallery",onClick:s=>t(s,"gallery"),children:"Photos"}),e.jsx("a",{href:"#amenities",onClick:s=>t(s,"amenities"),children:"Amenities"}),e.jsx("a",{href:"#reviews",onClick:s=>t(s,"reviews"),children:"Reviews"}),e.jsx("a",{href:"#location",onClick:s=>{s.preventDefault()},children:"Location"})]})}function me({stay:t,setGalleryModal:s}){const n=a.useRef(),[r,d]=a.useState([]),[o,c]=a.useState(null),[u,w]=a.useState(!0);a.useEffect(()=>(t.imgUrls.length>=5&&(d(t.imgUrls.slice(0,5)),N()),()=>{o==null||o.disconnect()}),[]),a.useEffect(()=>{o&&o.observe(n.current)},[o]);function N(){const x=new IntersectionObserver(g=>{g[g.length-1].isIntersecting?(B(!0),w(!0)):(B(!1),w(!1))});c(x)}function y(){s(!0)}return e.jsxs(e.Fragment,{children:[!u&&e.jsx(ge,{}),e.jsxs("section",{className:"gallery-stay-details",id:"gallery",ref:n,children:[r&&r.map((x,g)=>e.jsx("img",{src:x,className:`img${g}`},g)),e.jsxs("button",{className:"show-all-btn flex align-center",onClick:y,children:[e.jsx(he,{svgString:te.showallphotos})," Show all photos"]})]})]})}function pe({beds:t}){const[s,n]=a.useState({});a.useEffect(()=>{r()},[]);function r(){const o=t.reduce((c,u)=>(c[u]?c[u]++:c[u]=1,c),{});n(o)}function d(){let o="";return t.forEach((c,u)=>{s[c]>1?o+=`${s[c]} ${c}s`:o+=`${s[c]} ${c}`,o+=u<t.length-1?", ":""}),o}return s&&e.jsx("p",{className:"bedroom-details",children:d()})}function be({stay:t,userReview:s,onAddReviewModal:n,onReviewsModal:r,isReviewable:d,removeStayReview:o}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overlay",onClick:r}),e.jsxs("div",{className:"reviews-modal",children:[e.jsx("div",{className:"action-div",children:e.jsx("button",{className:"exit-btn",onClick:r})}),e.jsx("div",{className:"modal-content",children:e.jsxs("section",{className:"stay-reviews grid",children:[t.reviews.sort((c,u)=>u.rate-c.rate).map((c,u)=>e.jsxs("article",{className:"review flex column",children:[e.jsxs("div",{className:"user flex align-center",children:[e.jsx("img",{src:c.by.imgUrl}),e.jsxs("div",{className:"user-details-txt flex column",children:[e.jsx("h3",{children:c.by.fullname}),e.jsx("p",{children:c.by.id})," "]})]}),e.jsxs("div",{className:"not-flip-div flex column",children:[e.jsxs("div",{className:"review-score flex align-center",children:[e.jsxs("p",{children:["★".repeat(Math.floor(c.rate)),e.jsx("span",{children:"★".repeat(5-Math.floor(c.rate))})]}),"•",e.jsx("h4",{children:b.timestampToMonthYear(c.at)})]}),e.jsx("div",{className:"review-content",children:e.jsx("p",{children:c.txt})})]}),s&&s.by._id===c.by._id&&e.jsx("button",{className:"delete-btn",onClick:()=>o(c.by._id)})]},`${c.by.id}${u}`)),e.jsx("div",{className:"actions-btns",children:d&&e.jsx("button",{onClick:n,className:"leave-review-btn",children:"Leave Review"})})]})})]})]})}function ve({stay:t,userId:s,onAddReviewModal:n,addStayReview:r}){const[d,o]=a.useState({rate:0,txt:""});a.useEffect(()=>{R.getUserReview(t,s)&&o(R.getUserReview(t,s))},[]);function c(x){o({...d,rate:x})}function u(x){return x<=d.rate?"yellow-star":"gray-star"}function w(x){const g=x.target.value;o(i=>({...i,txt:g}))}const N=a.useCallback(b.debounce(w,300),[]);function y(){setTimeout(()=>{r(d)},300)}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overlay",onClick:n}),e.jsxs("div",{className:"add-review-modal",children:[e.jsxs("header",{className:"flex center",children:[e.jsx("h1",{children:"Add review"}),e.jsx("button",{className:"exit-btn",onClick:n})]}),e.jsxs("div",{className:"modal-content flex column center",children:[e.jsxs("div",{className:"review-rate flex center",children:[e.jsx("h2",{children:"Rating:"}),e.jsx("button",{onClick:()=>c(1),className:`rate-1 ${u(1)}`,children:"★"}),e.jsx("button",{onClick:()=>c(2),className:`rate-2 ${u(2)}`,children:"★"}),e.jsx("button",{onClick:()=>c(3),className:`rate-3 ${u(3)}`,children:"★"}),e.jsx("button",{onClick:()=>c(4),className:`rate-4 ${u(4)}`,children:"★"}),e.jsx("button",{onClick:()=>c(5),className:`rate-5 ${u(5)}`,children:"★"})]}),e.jsxs("div",{className:"review-content flex column center",children:[e.jsx("h2",{children:"Write a review"}),e.jsx("textarea",{rows:"10",cols:"55",onChange:N})]})]}),e.jsx("footer",{className:"flex center",children:e.jsx("button",{onClick:y,children:"Save"})})]})]})}function je({stay:t,userId:s,isReviewable:n,addStayReview:r,removeStayReview:d,addReviewModal:o,setAddReviewModal:c}){const[u,w]=a.useState([]),[N,y]=a.useState(!1),[x,g]=a.useState(null);function i(f){let m="";for(let C=0;C<130;C++)m+=f[C];return m+="...",m}a.useEffect(()=>{if(s){const f=R.getUserReview(t,s);g(f)}},[t]),a.useEffect(()=>{w(t.reviews.sort((f,m)=>m.rate-f.rate).slice(0,6))},[t.reviews]);function S(){y(!N)}function v(){c(!o)}return e.jsxs(e.Fragment,{children:[u.length>0&&e.jsxs("section",{className:"stay-reviews-section grid",children:[u.map((f,m)=>e.jsxs("article",{className:"review flex column",children:[e.jsxs("div",{className:"user flex align-center",children:[e.jsx("img",{src:f.by.imgUrl}),e.jsxs("div",{className:"user-details-txt flex column",children:[e.jsx("h3",{children:f.by.fullname}),e.jsx("p",{children:f.by._id})," "]})]}),e.jsxs("div",{className:"not-flip-div flex column",children:[e.jsxs("div",{className:"review-score flex align-center",children:[e.jsxs("p",{children:["★".repeat(Math.floor(f.rate)),e.jsx("span",{children:"★".repeat(5-Math.floor(f.rate))})]}),"·",e.jsx("h4",{children:b.timestampToMonthYear(f.at)})]}),e.jsxs("div",{className:"review-content",children:[e.jsx("p",{children:f.txt.length>130?i(f.txt):f.txt}),f.txt.length>130&&e.jsx("button",{onClick:S,children:"Read more"})]})]}),x&&x.by._id===f.by._id&&e.jsx("button",{className:"delete-btn",onClick:()=>d(f.by._id)})]},`${f.by._id}${m}`)),e.jsxs("div",{className:"actions-btns flex space-between",children:[e.jsx("button",{className:"show-all-btn",onClick:S,children:"Show all reviews"}),n&&e.jsx("button",{onClick:v,className:"leave-review-btn",children:"Leave Review"})]})]}),N&&e.jsx(be,{stay:t,userReview:x,onReviewsModal:S,onAddReviewModal:v,addStayReview:r,isReviewable:n,removeStayReview:d}),o&&s&&e.jsx(ve,{stay:t,userId:s,onAddReviewModal:v,addStayReview:r})]})}const $="stay/",we={query:Ne,getById:ye,save:ke,remove:Ce,getLabels:Se,getNumberOfNights:De,getFilterFromParams:Re,getEmptyOrder:$e,getEmptyStay:Me,getDefaultFilter:Y,getEmptyModalFilter:Le,getUserReview:Te,guestCountString:Ae,createDemoData:Ee,guestCountStringForReservation:Ue,generateRandomDate:_e,generateRandomDistance:Ie};function Ne(){return L.get($)}function ye(t){return L.get($+t)}function Se(t){return t.labels}function Ce(t){return L.delete($+t)}function ke(t){return t._id?L.put($,t):L.post($,t)}function De({entryDate:t,exitDate:s}){const n=s-t;return Math.ceil(n/(1e3*60*60*24))}function Re(t){const s=Y();return{txt:t.get("txt")||s.txt,entryDate:t.get("entryDate")||s.entryDate,exitDate:t.get("exitDate")||s.exitDate,guestCount:t.get("guestCount")||s.guestCount,label:t.get("label")||s.label,placeType:t.get("placeType")||s.placeType,priceRange:{min:t.get("priceRangeMin")||s.priceRange.min,max:t.get("priceRangeMax")||s.priceRange.max},bbb:{bedrooms:t.get("bedrooms")||s.bbb.bedrooms,beds:t.get("beds")||s.bbb.beds,bathrooms:t.get("bathrooms")||s.bbb.bathrooms},propType:t.get("propType")||s.propType,amenities:t.getAll("amenities")||s.amenities,bookingOpts:{instant:t.get("instant")==="true"||s.bookingOpts.instant,selfCheckIn:t.get("selfCheckIn")==="true"||s.bookingOpts.selfCheckIn,allowsPets:t.get("allowsPets")==="true"||s.bookingOpts.allowsPets},accessibility:t.getAll("accessibility")||s.accessibility,hostLngs:t.getAll("hostLngs")||s.hostLngs}}function Me(){return{placeType:"",propertyType:"",name:"",summary:"",price:0,capacity:0,amenities:[],labels:[],reviews:[],imgUrls:[],bookingOpts:{instant:!1,selfCheckIn:!1,allowsPets:!1},bbb:{bathrooms:0,baths:0,bedrooms:[],beds:0},loc:{country:"",countryCode:"",city:"",address:"",lng:0,lat:0},host:{_id:"",fullname:"",location:"",about:"",responseTime:"",experience:{isSuperhost:!1}},bookedDates:[],likedByUsers:[]}}function Y(){return{txt:"",entryDate:"",exitDate:"",guestCount:{adults:0,children:0,infants:0,pets:0},label:"",placeType:"any",priceRange:{min:0,max:2e3},bbb:{bedrooms:"any",beds:"any",bathrooms:"any"},propType:[],amenities:[],bookingOpts:{instant:!1,selfCheckIn:!1,allowsPets:!1},accessibility:[],hostLngs:[],pagination:30}}function Le(){return{placeType:"any",priceRange:{min:0,max:2e3},bbb:{bedrooms:"any",beds:"any",bathrooms:"any"},propType:[],amenities:[],bookingOpts:{instant:!1,selfCheckIn:!1,allowsPets:!1},accessibility:[],hostLngs:[]}}function $e(){return{hostId:"",buyer:{_id:"",fullName:""},totalPrice:0,entryDate:"",exitDate:"",guests:{adults:0,children:0,infants:0,pets:0},stay:{_id:"",name:"",price:0},msgs:[],status:"pending"}}function Te(t,s){return t.reviews.find(n=>n.by._id===s)}function Ee(t,s){return b.loadFromStorage(t)?b.loadFromStorage(t):b.saveToStorage(t,s)}function Ae(t){const s=t.guestCount.adults+t.guestCount.children;let n="";s>0&&(n=s===1?"1 guest":`${s} guests`);const r=t.guestCount.infants>0?`${t.guestCount.infants} infants`:"",d=t.guestCount.pets>0?`${t.guestCount.pets} pets`:"",o=[n,r,d].filter(Boolean);return o.length===0?"Add guests":o.join(", ")}function Ue(t){const s=+t.adults+ +t.children;let n="";s>0&&(n=s===1?"1 guest":`${s} guests`);const r=t.infants>0?`${t.infants} infants`:"",d=t.pets>0?`${t.pets} pets`:"",o=[n,r,d].filter(Boolean);return o.length===0?"Add guests":o.join(", ")}function _e(t){const s=["Apr 25-26","Apr 27-29","Apr 30-31","May 1-3","May 6-9","Apr 23-25","May 22-24","May 26-29","June 3-5","June 10-13","June 17-19","June 23-26","June 2-5","June 9-11","June 15-18","June 22-24","June 28-30"];let n;return t>=0&&t<=60?n=s[0]:t>60&&t<=120?n=s[1]:t>120&&t<=180?n=s[2]:t>180&&t<=240?n=s[3]:t>240&&t<=300?n=s[4]:t>300&&t<=360?n=s[5]:t>360&&t<=420?n=s[6]:t>462&&t<=480?n="Apr 23-25":t>480&&t<=540?n=s[8]:t>540&&t<=600?n=s[9]:t>600&&t<=660?n=s[10]:t>660&&t<=720?n=s[11]:t>720&&t<=780?n=s[12]:t>780&&t<=840?n=s[13]:t>840&&t<=900?n=s[14]:t>900&&t<=960?n=s[15]:t>960&&t<=1020?n=s[16]:t>1020&&t<=1080?n=s[17]:t>1080&&t<=1140?n=s[18]:n=s[19],n}function Ie(t){const s=t.loc.country.toLowerCase(),n={turkey:Math.floor(2050+t.loc.lng),"united states":Math.floor(9500+t.loc.lng),france:Math.floor(2900+t.loc.lng),portugal:Math.floor(3600+t.loc.lng),spain:Math.floor(2800+t.loc.lng),brazil:Math.floor(9400+t.loc.lng),canada:Math.floor(7800+t.loc.lng),"hong kong":Math.floor(5600+t.loc.lng),italy:Math.floor(2100+t.loc.lng)};return s in n?n[s].toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):(Math.floor(Math.random()*2001)+1e3).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function Be({stay:t,searchParams:s}){const n=J();function r(){if(s.entryDate&&s.exitDate&&(s.adults||s.children||s.infants)){const d=new URLSearchParams({entryDate:s.entryDate,exitDate:s.exitDate,adults:s.adults||"",children:s.children||"",infants:s.infants||""}).toString();n(`/${t._id}/payment?${d}`)}}return e.jsxs("div",{className:"dynamic-modal-header flex align-center",children:[e.jsxs("div",{className:"txt-container flex column",children:[e.jsxs("h3",{children:["$",t.price," ",e.jsx("span",{children:"night"})]}),e.jsxs("p",{className:"txt-reviews",children:["★ ",b.calcRate(t).toFixed(2)," ・ ",t.reviews.length," reviews "]})]}),e.jsx("button",{className:"flex center",onClick:()=>r(),children:"Reserve"})]})}function Fe({stay:t,searchParams:s,setSearchParams:n,bottomClass:r}){const d=J(),[o,c]=a.useState(0),[u,w]=a.useState(0),[N,y]=a.useState(!1),[x,g]=a.useState(null),[i,S]=a.useState(!1),[v,f]=a.useState(null),m=a.useRef(null),C=a.useRef();a.useEffect(()=>{c(b.calcSumOfDays(s)),j(),o&&w(parseInt(o*t.price*.14125))},[s,o]),a.useEffect(()=>{const p=k=>{m.current&&!m.current.contains(k.target)&&g("")};return document.addEventListener("click",p),()=>document.removeEventListener("click",p)},[m]),a.useEffect(()=>(v&&v.observe(C.current),()=>v==null?void 0:v.disconnect()),[v]);function j(){let p=0;const k=new IntersectionObserver(U=>{if(p++,p>2){const T=se.getState().stayModule.isGalleryVisible;!U[0].isIntersecting&&!T?S(!0):S(!1)}});f(k)}function M(p){if(p.stopPropagation(),s.entryDate&&s.exitDate&&s.adults){const k=b.getFormattedParams(s);H.getLoggedInUser()?d(`/${t._id}/payment?${k}`):y(!0)}}return e.jsxs(e.Fragment,{children:[i&&e.jsx(Be,{stay:t,searchParams:s}),e.jsxs("div",{className:"reserve-modal",ref:m,children:[e.jsxs("div",{className:"container-price-selectors",children:[e.jsxs("div",{className:"price-logo flex align-center",children:[e.jsxs("h2",{children:["$",Math.ceil(t.price),"  "]}),e.jsx("span",{children:"night"})]}),e.jsxs("div",{className:"selectors-container flex column",children:[e.jsxs("div",{className:"date-selectors flex",children:[e.jsx("div",{className:"check-in flex",onClick:()=>g(x==="date"?null:"date"),children:e.jsxs("div",{className:"txt flex column",children:[e.jsx("label",{children:"Check-in"}),e.jsxs("div",{className:"txt-date",children:[F(+s.entryDate),"/",O(+s.entryDate)+1,"/",G(+s.entryDate)]})]})}),e.jsx("div",{className:"checkout flex",onClick:()=>g(x==="date"?null:"date"),children:e.jsxs("div",{className:"txt flex column",children:[e.jsx("label",{children:"Checkout"}),e.jsx("div",{className:"txt-date",children:s.exitDate&&!isNaN(+s.exitDate)?`${F(+s.exitDate)}/${O(+s.exitDate)+1}/${G(+s.exitDate)}`:"Add date"})]})})]}),e.jsxs("div",{ref:m,className:"guest-selector flex column",children:[e.jsx("label",{onClick:()=>g(x==="guest"?null:"guest"),className:"guests",children:"Guests"}),e.jsxs("div",{className:"guest-container flex space-between",onClick:()=>g(x==="guest"?null:"guest"),children:[we.guestCountStringForReservation(s),e.jsx("span",{className:`arrow-${x==="guest"?"up":"down"}`})]}),x==="guest"&&e.jsx(xe,{stay:t,searchParams:s,setSearchParams:n,setModal:g}),x==="date"&&e.jsx(fe,{stay:t,searchParams:s,setSearchParams:n})]})]}),e.jsx("button",{className:"reserve-btn flex center",ref:C,onClick:p=>M(p),children:"Reserve"}),+s.entryDate&&+s.exitDate&&e.jsx("p",{className:"charged-p",children:"You won't be charged yet."})]}),e.jsxs("div",{className:"price-calc flex space-between",children:[e.jsxs("span",{children:["$",t.price," X ",o===1?`${o} night`:`${o} nights`]}),e.jsxs("span",{className:"sum",children:["$",Math.ceil(t.price*o*(+s.adults+ +s.children))]})]}),u&&e.jsxs("div",{className:"fee-calc flex space-between",children:[e.jsx("span",{children:"Staybnb service fee"}),e.jsxs("span",{children:["$",u]})]}),u>0&&e.jsxs("div",{className:"sum-total flex space-between",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",Math.ceil(t.price*o*(+s.adults+ +s.children)+u)]})]})]}),e.jsxs("div",{className:`reserve-footer flex align-center space-between ${r}`,children:[e.jsxs("div",{className:"flex column",children:[e.jsxs("p",{children:[e.jsxs("span",{children:["$",t.price]}),"  night"]}),e.jsx("p",{children:b.timestampsToShortDates(+s.entryDate,+s.exitDate)})]}),e.jsx("button",{className:"flex center",onClick:p=>M(p),children:e.jsx("span",{children:"Reserve"})})]}),N&&e.jsx(ne,{setIsLoginModal:y})]})}function Oe({stay:t,setGalleryModal:s}){function n(){s(!1)}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overlay",onClick:n}),e.jsxs("section",{className:"gallery-modal",children:[e.jsxs("header",{className:"flex center",children:[e.jsx("button",{className:"back-btn",onClick:n}),e.jsxs("h1",{children:[t.name," Galley"]})]}),e.jsx("main",{className:"grid",children:t.imgUrls.map((r,d)=>e.jsx("img",{src:r,className:`img-${d}`},d))})]})]})}const He=()=>{const{stayId:t}=le(),{isLoading:s}=ie(l=>l.stayModule),n=["Carbon monoxide alarm","Smoke alarm"],[r,d]=oe(),{adults:o,children:c,infants:u,pets:w,entryDate:N,exitDate:y}=Object.fromEntries(r.entries()),[x,g]=a.useState({adults:o,children:c,infants:u,pets:w,entryDate:N,exitDate:y}),[i,S]=a.useState(""),[v,f]=a.useState(1),[m,C]=a.useState(!1),[j,M]=a.useState(null),[p,k]=a.useState(!1),[U,T]=a.useState(null),[q,I]=a.useState(!1),[z,_]=a.useState("");a.useEffect(()=>{const l=H.getLoggedInUser();l&&M(l),t&&V(t)},[]),a.useEffect(()=>{const l=()=>{_(""),Math.ceil(window.scrollY+window.innerHeight)>=document.body.scrollHeight&&(window.innerWidth<=742&&_("bottom-mobile"),window.innerWidth>742&&_("bottom-tablet"))};return window.addEventListener("scroll",l),()=>window.removeEventListener("scroll",l)},[]),a.useEffect(()=>{i&&f(b.calcLongestBedCount(i)),d(x)},[i,x]),a.useEffect(()=>{i&&j&&(X(),k(!!j.wishlist.find(l=>l._id===i._id)))},[i,j]);async function V(l){try{const h=await ae(l);S(h)}catch(h){throw Error("err",h)}}async function X(){try{const l=await ue.getUserOrdersById(j._id),h=R.getUserReview(i,j._id);T(l.some(D=>D.stay._id===t)&&!h)}catch(l){console.error("err",l),T(!1)}}function K(){const l=i.host,h=l.fullname.indexOf(" ");return l.fullname.slice(0,h)}async function Q(){try{const l=await de(t);M(l),k(!p)}catch(l){throw l}}async function Z(){try{const l=window.location.href;await navigator.clipboard.writeText(l),alert("URL copied to clipboard!")}catch(l){console.error("Failed to copy: ",l)}}async function P(l){l.at=new Date().getTime(),l.by={_id:j._id,fullname:j.fullname,imgUrl:j.imgUrl};try{const h=await R.save({...i,reviews:[...i.reviews,l]});W(h),S(h),I(!1)}catch(h){throw Error("err",h)}}async function ee(){try{const l=i.reviews.findIndex(h=>h.by._id===j._id);if(l!==-1){const h=[...i.reviews];h.splice(l,1);const D={...i,reviews:h},E=await R.save(D);W(E),S(E)}else throw Error("Review not found")}catch(l){throw Error(l)}}return e.jsxs(e.Fragment,{children:[s&&e.jsx(ce,{currentPage:"details"}),i&&e.jsxs("section",{className:"stay-details",children:[e.jsxs("header",{className:"flex space-between",children:[e.jsx("h1",{children:i.summary}),e.jsxs("div",{className:"header-btns flex",children:[e.jsxs("button",{className:"share-btn flex align-center",onClick:Z,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",role:"presentation",focusable:"false",style:{display:"block",fill:"none",height:"16px",width:"16px",stroke:"currentcolor",strokeWidth:"2",overflow:"visible"},children:e.jsx("g",{fill:"none",children:e.jsx("path",{d:"M27 18v9a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-9M16 3v23V3zM6 13l9.3-9.3a1 1 0 0 1 1.4 0L26 13"})})}),e.jsx("span",{children:"Share"})]}),e.jsxs("button",{className:"save-btn flex align-center",onClick:Q,children:[!p&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",role:"presentation",focusable:"false",style:{display:"block",fill:"none",height:"16px",width:"16px",stroke:"currentcolor",strokeWidth:2,overflow:"visible"},children:e.jsx("path",{d:"M16 28c7-4.73 14-10 14-17a6.98 6.98 0 0 0-7-7c-1.8 0-3.58.68-4.95 2.05L16 8.1l-2.05-2.05a6.98 6.98 0 0 0-9.9 0A6.98 6.98 0 0 0 2 11c0 7 7 12.27 14 17z"})}),p&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",role:"presentation",focusable:"false",style:{display:"block",fill:"rgb(255, 56, 92)",height:"16px",width:"16px",stroke:"rgb(255, 56, 92)",strokeWidth:"2",overflow:"visible"},children:e.jsx("path",{d:"M16 28c7-4.73 14-10 14-17a6.98 6.98 0 0 0-7-7c-1.8 0-3.58.68-4.95 2.05L16 8.1l-2.05-2.05a6.98 6.98 0 0 0-9.9 0A6.98 6.98 0 0 0 2 11c0 7 7 12.27 14 17z"})}),e.jsx("span",{children:"Save"})]})]})]}),e.jsx(me,{stay:i,setGalleryModal:C}),e.jsxs("main",{className:"content-and-modal-container grid",children:[e.jsxs("section",{className:"content",children:[e.jsxs("article",{className:"place-info flex column",children:[e.jsxs("h1",{children:["Entire ",i.propertyType," in ",i.loc.city,", ",i.loc.country]}),e.jsxs("p",{children:[i.capacity>1?i.capacity+" guests":"1 guest","・ ",i.bbb.bedrooms.length>1?i.bbb.bedrooms.length+" bedrooms":"1 bedroom","  ・",b.countBedsInBedrooms(i)>1?b.countBedsInBedrooms(i)+" beds":"1 bed"," ・",i.bbb.baths>1?i.bbb.baths+" baths":"1 bath"]}),e.jsxs("p",{className:"reviews-preview",children:["★".repeat(Math.ceil(b.calcRate(i)))," ",b.calcRate(i).toFixed(2)," ・ ",i.reviews.length," reviews"]})]}),e.jsxs("article",{className:"host-info flex",children:[e.jsx("img",{src:i.host.imgUrl,className:"host-img"}),e.jsxs("div",{className:"flex column",children:[e.jsxs("h3",{children:["Hosted by ",K()]}),e.jsx("p",{children:i.host.about})]})]}),e.jsxs("article",{className:"room-info",children:[e.jsx("h1",{children:"Where you'll sleep"}),e.jsx("div",{className:"rooms-container grid",children:i.bbb.bedrooms.map(l=>{const h=l.beds.length;return e.jsxs("div",{className:"bedroom",style:{paddingBlockEnd:h<v?(v-h)*.875+1.5+"rem":"1.5rem"},children:[e.jsx("div",{className:"icons flex align-center",children:l.beds.map((D,E)=>e.jsx(A,{name:D.replaceAll(" ","").toLowerCase()},l+E))}),e.jsx("h4",{children:l.name}),e.jsx(pe,{beds:l.beds})]},l.name)})})]}),e.jsxs("article",{className:"amenity-info",id:"amenities",children:[e.jsx("h1",{children:"What this place offers "}),e.jsxs("ul",{className:"amenities-ul grid",children:[i.amenities.slice(0,9).map(l=>e.jsxs("li",{className:"flex align-center",children:[e.jsx(A,{name:l.replaceAll(" ","").toLowerCase()}),e.jsx("p",{children:l[0].toUpperCase()+l.slice(1)})]},l)),e.jsxs("li",{className:`${i.amenities.includes(n[0])?"":"no-safety-amenity"} flex align-center`,children:[e.jsx(A,{name:n[0].replaceAll(" ","").toLowerCase()}),e.jsx("p",{children:n[0]})]}),e.jsx(re,{children:i.amenities.slice(9).map(l=>e.jsxs("li",{className:"flex align-center",children:[e.jsx(A,{name:l.replaceAll(" ","").replaceAll("'","").toLowerCase()}),e.jsx("p",{children:l[0].toUpperCase()+l.slice(1)})]},l))})]})]})]}),e.jsx(Fe,{stay:i,searchParams:x,setSearchParams:g,bottomClass:z})]}),e.jsx("div",{id:"reviews",children:e.jsx(je,{stay:i,userId:j?j._id:null,isReviewable:U,addStayReview:P,removeStayReview:ee,setAddReviewModal:I,addReviewModal:q})})]}),m&&e.jsx(Oe,{stay:i,setGalleryModal:C})]})};export{He as default};
>>>>>>>> 4b62931453c56c77b6f292dbd00603d3c8b08444:backend/public/assets/StayDetails-269857d3.js
