import{r as n,i as b,b as w,w as m,y as g,a as k,j as s,o as P,u as d,x as U}from"./index-a64648f6.js";import{o as T}from"./order.service-39e9e4a5.js";import{u as $}from"./order.actions-c006727c.js";import"./chat.service-6b39b482.js";const H=()=>{const[p,R]=n.useState(b.getLoggedInUser()),[l,u]=n.useState(),[h,S]=n.useState(),[o,f]=n.useState("date"),[A,N]=n.useState(!1),[B,D]=n.useState(null),x=w();n.useEffect(()=>(O(),m.on(g,e=>{u(t=>[e,...t])}),()=>{m.off(g)}),[]),n.useEffect(()=>{v()},[o]);async function v(){try{const e=await T.getHostOrdersById(p._id,o);u(e)}catch(e){throw console.log(e),e}}async function O(){try{const e=await k.getHostStaysById(p._id);S(e)}catch(e){throw console.log(e),e}}function j(e){f(e)}async function y(e,t,c){c.stopPropagation();try{const a={...t,status:e};await $(a),u(r=>r.map(i=>i._id===a._id?a:i)),m.emit(U,a)}catch(a){throw console.log(a),a}}function C(e,t){e.stopPropagation(),x(`/edit/${t}`)}function E(e,t){e.stopPropagation();const c=new Date().setHours(0,0,0,0),a=new Date(c).setDate(new Date(c).getDate()+1),r=new URLSearchParams({adults:2,children:0,infants:0,pets:0,entryDate:c,exitDate:a}).toString();x(`/${t}?${r}`)}function _(e){D(e),N(!0)}return s.jsxs(s.Fragment,{children:[!h&&!l&&s.jsx(P,{currentPage:"dashBoard"}),s.jsxs("section",{className:"dashboard",children:[h&&s.jsxs("div",{className:"user-stays",children:[s.jsx("h2",{children:"My properties"}),s.jsx("div",{className:"user-stays-container grid",children:h.map(e=>s.jsxs("article",{className:"user-stay-card flex column",onClick:t=>E(t,e._id),children:[s.jsx("img",{src:e.imgUrls[0]}),s.jsx("h2",{children:e.name}),s.jsxs("p",{children:[s.jsx("span",{children:"Capacity:"})," ",e.capacity]}),s.jsxs("p",{children:[s.jsx("span",{children:"Price:"})," $",e.price]}),s.jsx("button",{onClick:t=>C(t,e._id),children:"Edit"})]},e._id))})]}),l&&s.jsxs("div",{className:"user-orders flex column",children:[s.jsx("h2",{children:"My orders"}),s.jsxs("ul",{className:"user-orders-container flex column",children:[s.jsxs("li",{className:"grid",children:[s.jsx("h3",{onClick:()=>j("name"),className:`title ${o==="name"?"selected":""}`,children:"Property name"}),s.jsx("h3",{onClick:()=>j("date"),className:o==="date"?"selected":"",children:"Dates"}),s.jsx("h3",{className:"also-tablet num",children:"Order number"}),s.jsx("h3",{className:"only-desktop",children:"Guest"}),s.jsx("h3",{className:"also-tablet num",children:"Guests"}),s.jsx("h3",{className:"only-desktop num",children:"Price"}),s.jsx("h3",{className:"actions",children:"Actions"})]}),l&&l.map(e=>{var a,r;const t={entryDate:e.entryDate,exitDate:e.exitDate,adults:(a=e.guests)==null?void 0:a.adults,children:(r=e.guests)==null?void 0:r.children},c=e.status!=="pending";return s.jsxs("li",{className:"user-order grid",onClick:()=>_(e),children:[s.jsx("p",{className:"title",children:e.stay.name}),s.jsx("p",{children:d.timestampsToShortDates(e.entryDate,e.exitDate)}),s.jsx("p",{className:"also-tablet num",children:e._id.slice(18)}),s.jsx("p",{className:"only-desktop",children:e.buyer.fullname}),s.jsx("p",{className:"also-tablet num",children:d.calcGuestCount(e)}),s.jsxs("p",{className:"only-desktop num",children:["$ ",Math.ceil(d.calcSumToPay(t,e.stay)+Math.ceil(d.calcSumToPay(t,e.stay)*.14125))]}),s.jsxs("div",{className:`flex space-evenly ${c?"answered":""}`,children:[s.jsx("button",{onClick:i=>y("approved",e,i),className:`approve-btn ${e.status==="approved"?"approved":""}`,children:"Approve"}),s.jsx("button",{onClick:i=>y("rejected",e,i),className:`reject-btn ${e.status==="rejected"?"rejected":""}`,children:"Reject"})]})]},e._id)})]})]})]})]})};export{H as default};
